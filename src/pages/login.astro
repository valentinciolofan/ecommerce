---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Ecommerce | Login">
  <main>
    <h1>Login page</h1>

    <div class="form-container">
        <form action="" method="post">
            <input type="text" placeholder="Enter your email address" name="email">
            <input type="password" placeholder="Enter your password" name="password">
            <input type="submit" value="Login">
        </form>
    </div>
  </main>
</Layout>

<style>
main {
    height: 60vh;
    display: flex;
    gap: 45px;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
.form-container {
    background: white;
    padding: 40px;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
    width: 300px;
    max-width: 100%;
}

form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

input[type="text"], input[type="password"] {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 0; /* No border-radius as per requirement */
}

input[type="submit"] {
    background-color: black;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 0; /* No border-radius as per requirement */
}

input[type="submit"]:hover {
    background-color: #333;
}

</style>


<script>
const url = "http://localhost:3000/login";
async function onSubmit(url, data) {
    try {
        const response = await fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const message = await response.text();
        console.log(message);
        window.location.href = '/';
    } catch (error) {
        console.error('Error:', error);
    }
}

function handleSubmit(event) {
  event.preventDefault();

  const data = new FormData(event.target);

  // Do a bit of work to convert the entries to a plain JS object
  const values = Object.fromEntries(data.entries());

  console.log( values );
  onSubmit(url, values);
}

const form = document.querySelector('form');
form.addEventListener('submit', handleSubmit);

</script>
