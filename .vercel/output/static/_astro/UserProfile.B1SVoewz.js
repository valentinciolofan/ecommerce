import{j as e}from"./jsx-runtime.CzgMDNMm.js";import{r as a}from"./index.DQ2WTIsS.js";import{u as k,a as x}from"./UserContext.6V2hC7ai.js";import{u as E}from"./urlFor.DCL5kvad.js";/* empty css                               */import"./image-url.umd.B12jX_S8.js";const F=({products:h})=>{const i=k(x),[l,m]=a.useState("profileInformation"),[p,v]=a.useState({}),[c,j]=a.useState({}),[f,w]=a.useState(null),[O,g]=a.useState(!1),u=s=>{m(s),localStorage.setItem("currentSection",s)},y=s=>{const{name:r,value:t}=s.target;v({...p,[r]:t})},N=s=>{j({...c,[s]:!c[s]})},C=async s=>{const r={[s]:p[s]||i[s]};try{const t=await fetch("http://localhost:3000/update-profile",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok){const d=await t.json();throw new Error(`Server responded with status ${t.status}: ${d.error}`)}const n=await t.json();j({...c,[s]:!1}),w(null)}catch(t){console.error("Error updating profile:",t),w(`Failed to update profile: ${t.message}`)}},o=(s,r,t="text")=>{const n=p[r]??i?.[r]??"";return e.jsxs("div",{className:"input-with-icon",children:[e.jsx("label",{htmlFor:`profile-user-${r}`,children:s}),e.jsxs("div",{className:"input-container",children:[e.jsx("input",{type:t,name:r,value:n,readOnly:!c[r],onChange:y}),e.jsx("svg",{onClick:()=>N(r),xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 512 512",children:e.jsx("path",{fill:"black",d:"m362.7 19.3l-48.4 48.4l130 130l48.4-48.4c25-25 25-65.5 0-90.5l-39.4-39.5c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2c-2.5 8.5-.2 17.6 6 23.8s15.3 8.5 23.7 6.1L151 475.7c14.1-4.2 27-11.8 37.4-22.2l233.3-233.2z"})}),c[r]&&e.jsx("button",{onClick:()=>C(r),children:"Save"})]})]})};a.useEffect(()=>{if(i&&h){const r=i.wishlist.map(t=>h.find(d=>d.slug.current===t)||t);JSON.stringify(i.wishlist)!==JSON.stringify(r)&&x.set({...i,wishlist:r}),g(!0)}const s=localStorage.getItem("currentSection");s!==null&&m(s)},[i,h]),console.log(i);const S=async s=>{try{const r=s.target.closest("SVG").parentNode.parentNode.firstChild.pathname.slice(9),t=await fetch("http://localhost:3000/remove-wishlist-product",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:r})});if(!t.ok)throw new Error(`Error: ${t.statusText}`);const n=await t.json();if(n.status==="OK"){const d=i.wishlist.filter(b=>b.slug.current!==r);x.set({...i,wishlist:d})}else console.error("Error:",n.message||"Failed to remove product from wishlist")}catch(r){console.error("Error handling wishlist product:",r.message),alert("An error occurred while trying to remove the product from your wishlist. Please try again later.")}};return i?e.jsxs("div",{className:"profile-container",children:[e.jsx("h2",{children:"Profile"}),e.jsxs("div",{className:"profile-wrapper",children:[e.jsxs("div",{className:"profile-info left-col",children:[e.jsxs("button",{className:`profile-button ${l==="profileInformation"?"active":""}`,onClick:()=>u("profileInformation"),children:[e.jsx("span",{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5em",height:"1.5em",viewBox:"0 0 32 32",children:e.jsx("path",{fill:"black",d:"M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7m10 28h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z"})})}),e.jsx("span",{children:"My account"})]}),e.jsxs("button",{className:`profile-button ${l==="profileOrders"?"active":""}`,onClick:()=>u("profileOrders"),children:[e.jsx("span",{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",children:e.jsxs("g",{fill:"none",stroke:"black",strokeWidth:"2",children:[e.jsx("rect",{width:"14",height:"17",x:"5",y:"4",rx:"2"}),e.jsx("path",{strokeLinecap:"round",d:"M9 9h6m-6 4h6m-6 4h4"})]})})}),e.jsx("span",{children:"My orders"})]}),e.jsxs("button",{className:`profile-button ${l==="profileWishlist"?"active":""}`,onClick:()=>u("profileWishlist"),children:[e.jsx("span",{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"m12.1 18.55l-.1.1l-.11-.1C7.14 14.24 4 11.39 4 8.5C4 6.5 5.5 5 7.5 5c1.54 0 3.04 1 3.57 2.36h1.86C13.46 6 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5c0 2.89-3.14 5.74-7.9 10.05M16.5 3c-1.74 0-3.41.81-4.5 2.08C10.91 3.81 9.24 3 7.5 3C4.42 3 2 5.41 2 8.5c0 3.77 3.4 6.86 8.55 11.53L12 21.35l1.45-1.32C18.6 15.36 22 12.27 22 8.5C22 5.41 19.58 3 16.5 3"})})}),e.jsx("span",{children:"My Wishlist"})]})]}),e.jsxs("div",{className:"profile-info right-col",children:[l==="profileInformation"&&e.jsxs("div",{className:"profile-personal-information",children:[e.jsx("h4",{children:"Personal Information"}),f&&e.jsx("p",{className:"error",children:f}),o("Name","name"),o("Birth Date","birthdate","date"),o("Phone","phone"),e.jsx("p",{children:"Delivery Address"}),o("County","county"),o("City","city"),o("Address","address")]}),l==="profileOrders"&&e.jsxs("div",{children:[e.jsx("h4",{children:"My Orders"}),i.orders.length?e.jsxs("table",{className:"orders-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Order ID"}),e.jsx("th",{children:"Order Date"}),e.jsx("th",{className:"order-status",children:"Status"}),e.jsx("th",{children:"Receipt"})]})}),e.jsx("tbody",{children:i.orders.map((s,r)=>e.jsxs("tr",{className:r%2===0?"":"table-row1",children:[e.jsxs("td",{children:["#",s.order_id]}),e.jsx("td",{children:s.order_date.slice(0,10)}),e.jsx("td",{className:"order-status",children:e.jsxs("select",{value:s.order_status,onChange:t=>handleOrderStatus(t,r),children:[e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"In progress"}),e.jsx("option",{children:"Delivered"})]})}),e.jsx("td",{children:e.jsx("a",{href:s.receipt_url,children:"View receipt"})})]},s.order_id))})]}):e.jsxs("p",{children:["You didn't placed any order yet. You can see our products ",e.jsx("a",{href:"/shop",children:"here"})]})]}),l==="profileWishlist"&&e.jsx("div",{className:"all-products",children:e.jsxs("div",{className:"all-products-wrapper",children:[e.jsx("h4",{children:"My Wishlist"}),e.jsx("ul",{children:i.wishlist.length>0&&i.wishlist.every(s=>s?.slug?.current!==void 0)?i.wishlist.map(s=>e.jsx("li",{children:e.jsx("a",{href:"/product/"+s.slug.current,children:e.jsxs("div",{className:"products",children:[e.jsxs("div",{className:"wishlist-product-image",children:[e.jsx("img",{src:E(s.image).url(),alt:""}),e.jsx("span",{onClick:S,className:"btn-wishlist-product-remove",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 256 256",children:e.jsx("path",{fill:"currentColor",d:"M216 48h-40v-8a24 24 0 0 0-24-24h-48a24 24 0 0 0-24 24v8H40a8 8 0 0 0 0 16h8v144a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16V64h8a8 8 0 0 0 0-16M96 40a8 8 0 0 1 8-8h48a8 8 0 0 1 8 8v8H96Zm96 168H64V64h128Zm-80-104v64a8 8 0 0 1-16 0v-64a8 8 0 0 1 16 0m48 0v64a8 8 0 0 1-16 0v-64a8 8 0 0 1 16 0"})})})]}),e.jsx("div",{className:"product-details",children:e.jsx("div",{className:"product-title-and-price",children:e.jsx("span",{children:s.title})})})]})})},s.slug.current)):e.jsxs("li",{children:["Ups .. you didn't add any product to your wishlist yet. View all available products ",e.jsx("a",{href:"/shop",children:"here"})]})})]})})]})]})]}):e.jsx("div",{children:"Loading..."})};export{F as default};
